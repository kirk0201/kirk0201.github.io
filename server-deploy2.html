<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>AWS를 이용하여 서버 배포 및 HTTPS를 위해 Certbot으로 인증서 받기(2)</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <!-- 코드 하이라이트 monokai.sublime -->
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    
    <!-- 나눔고딕 폰트 -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">
    
    <!-- Font Awesome 아이콘 사용 -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/custom.css" />

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="나만의 TIL 블로그" />
    <link rel="shortcut icon" href="http://localhost:4000/assets/images/favicon.png" type="image/png" />
    <link rel="canonical" href="http://localhost:4000/server-deploy2" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="IT Technical Blog" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="AWS를 이용하여 서버 배포 및 HTTPS를 위해 Certbot으로 인증서 받기(2)" />
    <meta property="og:description" content="AWS를 이용하여 배포하기는 여러 절로 구성되어 있습니다. 해당글은 직접 경험을 바탕으로 정리한 것을 공유하는 글입니다. 혹시 잘못된 정보거나 부족한 정보에 대해 피드백을 주신다면 감사하겠습니다. AWS를 이용하여 클라이언트 배포 및 HTTPS를 위한 인증서 받기(1) AWS를 이용하여 클라이언트 배포 및 HTTPS를 위한 인증서 받기(2) 지난 시간에 AWS를 통해서 EC2로 가상 환경에 컴퓨터를" />
    <meta property="og:url" content="http://localhost:4000/server-deploy2" />
    <meta property="og:image" content="http://localhost:4000/assets/built/images/aws_cover.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2021-02-09T18:00:00+09:00" />
    <meta property="article:modified_time" content="2021-02-09T18:00:00+09:00" />
    <meta property="article:tag" content="Aws" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="AWS를 이용하여 서버 배포 및 HTTPS를 위해 Certbot으로 인증서 받기(2)" />
    <meta name="twitter:description" content="AWS를 이용하여 배포하기는 여러 절로 구성되어 있습니다. 해당글은 직접 경험을 바탕으로 정리한 것을 공유하는 글입니다. 혹시 잘못된 정보거나 부족한 정보에 대해 피드백을 주신다면 감사하겠습니다. AWS를 이용하여 클라이언트 배포 및 HTTPS를 위한 인증서 받기(1) AWS를 이용하여 클라이언트 배포 및 HTTPS를 위한 인증서 받기(2) 지난 시간에 AWS를 통해서 EC2로 가상 환경에 컴퓨터를" />
    <meta name="twitter:url" content="http://localhost:4000/" />
    <meta name="twitter:image" content="http://localhost:4000/assets/built/images/aws_cover.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="IT Technical Blog" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Aws" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "IT Technical Blog",
        "logo": "http://localhost:4000/"
    },
    "url": "http://localhost:4000/server-deploy2",
    "image": {
        "@type": "ImageObject",
        "url": "http://localhost:4000/assets/built/images/aws_cover.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:4000/server-deploy2"
    },
    "description": "AWS를 이용하여 배포하기는 여러 절로 구성되어 있습니다. 해당글은 직접 경험을 바탕으로 정리한 것을 공유하는 글입니다. 혹시 잘못된 정보거나 부족한 정보에 대해 피드백을 주신다면 감사하겠습니다. AWS를 이용하여 클라이언트 배포 및 HTTPS를 위한 인증서 받기(1) AWS를 이용하여 클라이언트 배포 및 HTTPS를 위한 인증서 받기(2) 지난 시간에 AWS를 통해서 EC2로 가상 환경에 컴퓨터를"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="AWS를 이용하여 서버 배포 및 HTTPS를 위해 Certbot으로 인증서 받기(2)" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="http://localhost:4000/">IT Technical Blog</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <!-- <li class="nav-about" role="menuitem"><a href="/about/">About</a></li> -->
    <li class="nav-javascript" role="menuitem"><a href="/tag/javascript/">JavaScript</a></li>
    <li class="nav-ts" role="menuitem"><a href="/tag/ts/">typescript</a></li>
    <li class="nav-react" role="menuitem"><a href="/tag/react/">React</a></li>
    <li class="nav-aws" role="menuitem"><a href="/tag/aws/">Aws</a></li>
    <li class="nav-github" role="menuitem"><a href="/tag/github/">Github 블로그</a></li>
    <li class="nav-archive" role="menuitem">
        <a href="/archive.html">All Posts</a>
    </li>
    <li class="nav-archive" role="menuitem">
        <a href="/author_archive.html">Tag별 Posts</a>
    </li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Subscribe</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-aws post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime=" 9 February 2021"> 9 February 2021</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/aws/'>AWS</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">AWS를 이용하여 서버 배포 및 HTTPS를 위해 Certbot으로 인증서 받기(2)</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/built/images/aws_cover.png)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p><span class="table-of-contents-list">AWS를 이용하여 배포하기는 여러 절로 구성되어 있습니다.<br /></span>
<span class="table-of-contents-list">해당글은 직접 경험을 바탕으로 정리한 것을 공유하는 글입니다. 
    <br />혹시 잘못된 정보거나 부족한 정보에 대해 피드백을 주신다면 감사하겠습니다.
</span></p>
<ul class="table-of-contents-list">
    <li><a href="./front-deploy">AWS를 이용하여 클라이언트 배포 및 HTTPS를 위한 인증서 받기(1) </a></li>
    <li><a href="./front-deploy2">AWS를 이용하여 클라이언트 배포 및 HTTPS를 위한 인증서 받기(2) </a></li>
</ul>

<p><br />
<br />
<br /></p>

<p>지난 시간에 <code class="highlighter-rouge">AWS</code>를 통해서 <code class="highlighter-rouge">EC2</code>로 가상 환경에 컴퓨터를 만들었고
우린 이 빈 컴퓨터에 서버 구동을 위한 도구들을 설치해 나갈 것이다</p>

<p>우선 <code class="highlighter-rouge">EC2</code> 가상환경에 접속을 하고
 <code class="highlighter-rouge">node.js</code>로 서버를 구성했기 때문에 <code class="highlighter-rouge">node.js</code>를 설치하겠다</p>

<p><br />
<br />
<br /></p>

<h1 id="nvm을-이용하여-nodejs-설치"><code class="highlighter-rouge">NVM</code>을 이용하여 <code class="highlighter-rouge">Node.js</code> 설치</h1>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get update
<span class="nb">sudo </span>apt-get <span class="nb">install </span>build-essential libssl-dev

curl <span class="nt">-sL</span> https://raw.githubusercontent.com/creationix/nvm/v0.31.0/install.sh <span class="nt">-o</span> install_nvm.sh // 한 줄

bash install_nvm.sh
<span class="nb">source</span> ~/.profile

nvm <span class="nt">--version</span>         <span class="c"># nvm 설치 확인</span>
nvm ls-remote         <span class="c"># 설치 가능한 버전 리스트를 보고 싶을때</span>
nvm <span class="nb">install</span> <span class="o">{</span>version<span class="o">}</span> <span class="c"># node원하는 버전을 설치 예시 - nvm install 14.15.0</span>

node <span class="nt">--version</span> <span class="c"># 확인</span>
nvm <span class="nb">alias </span>default 버전 <span class="c"># 해당 버전을 default값으로 설정한다</span>
</code></pre></div></div>

<p>이제 <code class="highlighter-rouge">Node.js</code>가 설치가 완료되었으면 다음으로 <code class="highlighter-rouge">nginx </code>로 웹서버를 돌려서 <code class="highlighter-rouge">Certbot</code>을 이용하여  <code class="highlighter-rouge">HTTTPS</code>를 위한 인증서를 발급 받을 것이다</p>

<p><img src="https://user-images.githubusercontent.com/45046152/111656692-1a991a00-884e-11eb-9e8b-876117c0193c.png" alt="img1" /></p>

<h1 id="2-nginx-설치">2. Nginx 설치</h1>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>nginx

/<span class="k">*</span> 참고 사항

systemctl start nginx // nignx 시작 확인
systemctl status nginx // nginx 상태 확인
systemctl stop nginx // nginx 정지
	
<span class="k">*</span>/

<span class="nb">sudo </span>vi /etc/nginx/sites-available/default 
</code></pre></div></div>

<p>아래와 같이 server_name에 <code class="highlighter-rouge">DNS</code> 명을 입력하고
location / {} 안에 proxy_pass http://localhost:4000 을 추가해준다
중간에 보이는 <code class="highlighter-rouge">root</code>와 <code class="highlighter-rouge">index</code>값들은 아래처럼 주석처리 해준다</p>

<p><img src="https://user-images.githubusercontent.com/45046152/111669772-78cbfa00-885a-11eb-8de2-d3620794daff.png" alt="img2" /></p>

<h1 id="3-certbot-설치">3. Certbot 설치</h1>

<p>인증서를 발급 받기 위해 <code class="highlighter-rouge">Certbot</code>을 설치해 준다
<a href="https://certbot.eff.org/">Certbot</a> 해당 페이지에 상세한 설명이 나와있다.</p>

<p>위 페이지에 가서 <code class="highlighter-rouge">install certbot</code>을 해준다. 그 후 나오는 페이지에서 우리는 <code class="highlighter-rouge">Nginx</code>로 인증을 받기 때문에
<code class="highlighter-rouge">Nginx</code>와 <code class="highlighter-rouge">EC2</code> 환경인 <code class="highlighter-rouge">Ubuntu 20.04</code>를 선택한다.</p>

<p>그럼 설치를 단계별로 알려주는 페이지가 나오는데 그 과정을 살펴보면 <code class="highlighter-rouge">snap</code>을 최신화하고 <code class="highlighter-rouge">snap</code>을 이용하여 <code class="highlighter-rouge">certbot</code>을 설치하여 <code class="highlighter-rouge">nginx</code>를 통해 인증서를 발급 한다는 내용이다</p>

<p>특별한게 없으니 설명대로 따라가자.</p>

<ol>
  <li><code class="highlighter-rouge">snap</code>을 이용하여 <code class="highlighter-rouge">certbot</code>을 설치하기 때문에 <code class="highlighter-rouge">snap</code>을 설치 또는 최신버전인지 확인한다</li>
</ol>

<p><img src="https://user-images.githubusercontent.com/45046152/112633494-c2c96700-8e7c-11eb-9c40-daab4e1dab91.png" alt="img_1" /></p>

<ol>
  <li><code class="highlighter-rouge">sudo snap install --classic certbot</code>을 이용하여 설치한다
<code class="highlighter-rouge">sudo ln -s /snap/bin/certbot /usr/bub/certbot</code> 명령어를 통해 복사해 온다</li>
</ol>

<p><img src="https://user-images.githubusercontent.com/45046152/112633728-0fad3d80-8e7d-11eb-8afe-0ea6442ed31e.png" alt="img_2" /></p>

<ol>
  <li><code class="highlighter-rouge">sudo certbot --nginx</code>를 이용하여 실행한다.</li>
</ol>

<p><img src="https://user-images.githubusercontent.com/45046152/112634454-f5c02a80-8e7d-11eb-9de1-97967e5ddc1a.png" alt="img_3" /></p>

<ol>
  <li><code class="highlighter-rouge">certbot</code>이 실행되면 아래와 같은 선택지가 나오는데 다음과 같이 따라하자
    <ol>
      <li>본인의 이메일을 적어 넣자.</li>
      <li>약관의 동의하는가? <code class="highlighter-rouge">Y</code></li>
      <li>EFF의 소식을 이메일로 받을 것인가? <code class="highlighter-rouge">N</code></li>
      <li>4번째 항목에서는 위에서 <code class="highlighter-rouge">nginx</code> <code class="highlighter-rouge">server_name</code>에 추가한 주소가 나올 것이다.
콤마와 스페이스로 추가할 번호를 적어주자 ex) 1 2</li>
    </ol>
  </li>
</ol>

<p><img src="https://user-images.githubusercontent.com/45046152/112635476-38cecd80-8e7f-11eb-9625-36dbc7ca7c30.png" alt="img_4" /></p>

<p><img src="https://user-images.githubusercontent.com/45046152/112636072-ee9a1c00-8e7f-11eb-8bd0-ca9c3a3cbb35.png" alt="img_5" /></p>

<p>성공적으로 발급이되면 아래와 같이 출력되는데 빨간선으로 <code class="highlighter-rouge">SSL인증서</code>의 <code class="highlighter-rouge">pem키</code>가 생성되니 해당 키를 이용하면 된다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/etc/letsencrypt/live/DNS명/fullchain.pem
/etc/letsencrypt/live/DNS명/privkey.pem
</code></pre></div></div>

<p>파란색 선은 인증서의 만료일이니 만료되기 전 갱신하는 것을 잊지 말자.</p>

<p><img src="https://user-images.githubusercontent.com/45046152/112636512-86980580-8e80-11eb-884e-cd129b49e5a2.png" alt="img_6" /></p>

<p>위에서 발급된 <code class="highlighter-rouge">key</code>를 본인이 작성한 서버에 추가하여 https 프로토콜로 구동해주면 된다</p>

<p>예제 코드는 다음과 같다</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="err">‘</span><span class="nx">express</span><span class="err">’</span><span class="p">);</span> <span class="c1">// const는 변수 선언입니다.</span>

<span class="kd">const</span> <span class="nx">https</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="err">‘</span><span class="nx">https</span><span class="err">’</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="err">‘</span><span class="nx">http</span><span class="err">’</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="err">‘</span><span class="nx">fs</span><span class="err">’</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span> <span class="c1">// letsencrypt로 받은 인증서 경로를 입력해 줍니다.</span>

<span class="na">ca</span><span class="p">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="err">‘</span><span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">letsencrypt</span><span class="o">/</span><span class="nx">live</span><span class="o">/</span><span class="p">[</span><span class="err">도메인</span> <span class="err">이름</span><span class="p">]</span><span class="o">/</span><span class="nx">fullchain</span><span class="p">.</span><span class="nx">pem</span><span class="err">’</span><span class="p">),</span>

<span class="na">key</span><span class="p">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="err">‘</span><span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">letsencrypt</span><span class="o">/</span><span class="nx">live</span><span class="o">/</span><span class="p">[</span><span class="err">도메인</span> <span class="err">이름</span><span class="p">]</span><span class="o">/</span><span class="nx">privkey</span><span class="p">.</span><span class="nx">pem</span><span class="err">’</span><span class="p">),</span>

<span class="na">cert</span><span class="p">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="err">‘</span><span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">letsencrypt</span><span class="o">/</span><span class="nx">live</span><span class="o">/</span><span class="p">[</span><span class="err">도메인</span> <span class="err">이름</span><span class="p">]</span><span class="o">/</span><span class="nx">cert</span><span class="p">.</span><span class="nx">pem</span><span class="err">’</span><span class="p">)</span>

<span class="p">};</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">80</span><span class="p">);</span>

<span class="nx">https</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">app</span><span class="p">).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">443</span><span class="p">);</span>  <span class="c1">// 이 부분이 https서버를 만드는 부분</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="err">‘</span><span class="o">/</span><span class="err">’</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span> <span class="c1">// 사이트 접속 시 나오는 내용입니다.</span>

<span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="err">‘</span><span class="nx">Hello</span> <span class="nx">World</span><span class="err">’</span><span class="p">);</span>

<span class="p">});</span>
</code></pre></div></div>

<h2 id="이슈">이슈</h2>

<h4 id="1-인증서-접근-에러-이슈">1. 인증서 접근 에러 이슈</h4>

<p>나는 위 모든 작업을 마무리하고 인증서와 서버를 연결할 때 아래와 같은 문제가 발생하였다.
<code class="highlighter-rouge">sudo npm start</code>를 하면 쉽게 해결이 되지만 보안적인 측면으로 좋지 않은 방법이라고 하여 아래와 같이 진행하였다.</p>

<blockquote>
  <p><code class="highlighter-rouge">/etc/letsencrypt/live/{DNS명}/fullchain.pem</code>경로로 <strong>permission denied 에러</strong>가 발생한다면
우분투에 특정 <code class="highlighter-rouge">group</code>과 <code class="highlighter-rouge">user</code>를 생성하여 접근 권한을 주는 방식으로 해결하였다</p>
</blockquote>

<p><code class="highlighter-rouge">stack overflow</code>에 해당 글을 참고하였다 <a href="https://stackoverflow.com/questions/48078083/lets-encrypt-ssl-couldnt-start-by-error-eacces-permission-denied-open-et">stackoverflow</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Create group with root and nodeuser as members
<span class="nv">$ </span><span class="nb">sudo </span>addgroup nodecert
<span class="nv">$ </span><span class="nb">sudo </span>adduser nodeuser
<span class="nv">$ </span><span class="nb">sudo </span>adduser nodeuser nodecert
<span class="nv">$ </span><span class="nb">sudo </span>adduser root nodecert

// Make the relevant letsencrypt folders owned by said group.
<span class="nv">$ </span><span class="nb">sudo chgrp</span> <span class="nt">-R</span> nodecert /etc/letsencrypt/live
<span class="nv">$ </span><span class="nb">sudo chgrp</span> <span class="nt">-R</span> nodecert /etc/letsencrypt/archive

// Allow group to open relevant folders
<span class="nv">$ </span><span class="nb">sudo chmod</span> <span class="nt">-R</span> 750 /etc/letsencrypt/live
<span class="nv">$ </span><span class="nb">sudo chmod</span> <span class="nt">-R</span> 750 /etc/letsencrypt/archive

// nodeuser로 사용자 변경
<span class="nv">$ </span>su nodeuser

// 사용자 나가기?
<span class="nv">$ </span><span class="nb">exit</span>
</code></pre></div></div>

<p>위 사용자변경 명령어를 입력한뒤 다시 서버를 구동하면 해결될 것이다.</p>

<h4 id="2-443포트에-접근할-수-없는-에러">2. 443포트에 접근할 수 없는 에러</h4>

<p>위 방법을 해결하니 <code class="highlighter-rouge">Error: listen EACCES: permission denied 0.0.0.0:443</code>이 에러가 발생했다.
찾아보니 위에 <code class="highlighter-rouge">user</code>를 생성하여 해당 사용자 환경에서 서버를 구동하면 <code class="highlighter-rouge">root</code>권한이 아니기 때문에
사용할 수 없다는 것을 알게 되었다.</p>

<p>일반 사용자가 <code class="highlighter-rouge">1024 포트</code> 아래의를 사용하기 위해서는, <code class="highlighter-rouge">1024포트</code> 위의 숫자로 서버를 띄우고, 해당 포트로
들어오는 요청을 <code class="highlighter-rouge">443 포트</code>로 리다이렉트 해줌으로써 해결한다</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// 포트 확인
// netstat이 설치되어 있지 않다면 설치 명령어가 출력되니 설치하여 사용  
<span class="nv">$ </span>netstat <span class="nt">-ntl</span>

// 포트 상태 확인
<span class="nv">$ </span><span class="nb">sudo </span>iptables <span class="nt">-t</span> nat <span class="nt">-L</span>

// 리다이렉트
<span class="nv">$ </span><span class="nb">sudo </span>iptables <span class="nt">-t</span> nat <span class="nt">-A</span> PREROUTING <span class="nt">-p</span> tcp <span class="nt">--dport</span> 443 <span class="nt">-j</span> REDIRECT <span class="nt">--to-port</span> 8080
</code></pre></div></div>

<p>위 명령어를 사용하여 리다이렉트를 해주고 포트 상태 확인 명령어로 리다이렉트가 제대로 설정되었는지 확인한 뒤 기존 서버를 <code class="highlighter-rouge">4000 포트 -&gt; 8080 포트</code>(내 기존 포트는 4000 이었다)로 바꿔 구동하고 다시 <code class="highlighter-rouge">nodeuser</code>로 가서 실행하면 해결된다.</p>

<h4 id="3-nodeuser에-sudo-권한-설정">3. nodeuser에 sudo 권한 설정</h4>

<p><code class="highlighter-rouge">nodeuser</code>사용자로 <code class="highlighter-rouge">pm2</code>가 설치 되지 않는 에러가 발생시 아래와 같이 <code class="highlighter-rouge">sudo 권한</code>을 추가하여 진행하였다</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// root로 접근
<span class="nv">$ </span>su

// 해당 파일에 특정 유저 계정이름이 추가되야 root 권한이 부여
<span class="nv">$ </span>vi /etc/sudoers

// 아래 명령어를 찾는다
root <span class="nv">ALL</span><span class="o">=(</span>ALL:ALL<span class="o">)</span> ALL

// 위 명령어 하단에 유저 계정 추가
계정명 <span class="nv">ALL</span><span class="o">=(</span>ALL:ALL<span class="o">)</span> ALL
ex] nodeuser <span class="nv">ALL</span><span class="o">=(</span>ALL:ALL<span class="o">)</span> ALL

</code></pre></div></div>

<h1 id="4-pm2-설치">4. PM2 설치</h1>

<p><code class="highlighter-rouge">PM2</code>는 우리가 OS를 종료하거나 컴퓨터를 종료하더라도 서버를 계속 유지시키는 <code class="highlighter-rouge">process manager</code>이다</p>

<p><code class="highlighter-rouge">npm install pm2 -g</code>를 이용하여 설치하자</p>

<p>사용법은 아주 간단하다.</p>

<p><code class="highlighter-rouge">pm2 examples</code>를 치면 알기 쉬운 여러 예제들이 나오니 참고하여 실행하면 된다</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// 서버를 실행할 스크립트를 넣는다
<span class="nv">$ </span>pm2 start app.js <span class="nt">--name</span> app

// pm2 상태 확인
<span class="nv">$ </span>pm2 status

// pm2 시작
<span class="nv">$ </span>pm2 start

// pm2 모니터로 로그확인
<span class="nv">$ </span>pm2 monit
</code></pre></div></div>

<p><br />
<br />
<br />
<span class="table-of-contents-list">AWS를 이용하여 배포하기는 여러 절로 구성되어 있습니다.<br /></span>
<span class="table-of-contents-list">해당글은 직접 경험을 바탕으로 정리한 것을 공유하는 글입니다. 
    <br />혹시 잘못된 정보거나 부족한 정보에 대해 피드백을 주신다면 감사하겠습니다.
</span></p>
<ul class="table-of-contents-list">
    <li><a href="./front-deploy">AWS를 이용하여 클라이언트 배포 및 HTTPS를 위한 인증서 받기(1) </a></li>
    <li><a href="./front-deploy2">AWS를 이용하여 클라이언트 배포 및 HTTPS를 위한 인증서 받기(2) </a></li>
</ul>


                </div>
            </section>

            
            <!-- Email subscribe form at the bottom of the page -->
            <!--
            
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to IT Technical Blog</h3>
                    <p>Get the latest posts delivered right to your inbox</p>
                    <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  /><input class="location" type="hidden" name="location"  /><input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email"  placeholder="youremail@example.com" />
    </div>
    <button class="" type="submit" disabled><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>

                </section>
            
            -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/images/ghost.png" alt="kirk0201" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/kirk0201">Kirk0201</a></h4>
                                
                                    <p>풀스택 개발자를 목표로 준비중입니다.</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/kirk0201">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            this.page.url = 'http://localhost:4000/server-deploy2';
                            this.page.identifier = '/server-deploy2';
                            this.page.title = 'AWS를 이용하여 서버 배포 및 HTTPS를 위해 Certbot으로 인증서 받기(2)';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://xxxxxxxx.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/sky.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; IT Technical Blog &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/aws/">Aws</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/server-deploy">AWS를 이용하여 서버 배포 및 HTTPS를 위해 Certbot으로 인증서 받기(1)</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/front-deploy2">AWS를 이용하여 클라이언트 배포 및 HTTPS 인증 받기 (2)</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/front-deploy">AWS를 이용하여 클라이언트 배포 및 HTTPS 인증 받기 (1)</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/aws/">
                                
                                    See all 3 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/ts-learn">
                <div class="post-card-image" style="background-image: url(/assets/built/images/ts_default.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/ts-learn">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Ts</span>
                            
                        
                    

                    <h2 class="post-card-title">타입스크립트 배워보기!</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/ghost.png" alt="Kirk0201" />
                        
                        <span class="post-card-author">
                            <a href="/author/kirk0201/">Kirk0201</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/server-deploy">
                <div class="post-card-image" style="background-image: url(/assets/built/images/aws_cover.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/server-deploy">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Aws</span>
                            
                        
                    

                    <h2 class="post-card-title">AWS를 이용하여 서버 배포 및 HTTPS를 위해 Certbot으로 인증서 받기(1)</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/ghost.png" alt="Kirk0201" />
                        
                        <span class="post-card-author">
                            <a href="/author/kirk0201/">Kirk0201</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="http://localhost:4000/">
            
            <span>IT Technical Blog</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">AWS를 이용하여 서버 배포 및 HTTPS를 위해 Certbot으로 인증서 받기(2)</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=AWS%EB%A5%BC+%EC%9D%B4%EC%9A%A9%ED%95%98%EC%97%AC+%EC%84%9C%EB%B2%84+%EB%B0%B0%ED%8F%AC+%EB%B0%8F+HTTPS%EB%A5%BC+%EC%9C%84%ED%95%B4+Certbot%EC%9C%BC%EB%A1%9C+%EC%9D%B8%EC%A6%9D%EC%84%9C+%EB%B0%9B%EA%B8%B0%282%29&amp;url=https://kirk0201.github.io/server-deploy2"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://kirk0201.github.io/server-deploy2"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="http://localhost:4000/">IT Technical Blog</a> &copy; 2021</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
        <div id="subscribe" class="subscribe-overlay">
            <a class="subscribe-overlay-close" href="#"></a>
            <div class="subscribe-overlay-content">
                
                <h1 class="subscribe-overlay-title">Subscribe to IT Technical Blog</h1>
                <p class="subscribe-overlay-description">Stay up to date! Get all the latest &amp; greatest posts delivered straight to your inbox</p>
                <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  /><input class="location" type="hidden" name="location"  /><input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email"  placeholder="youremail@example.com" />
    </div>
    <button class="" type="submit" disabled><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>

            </div>
        </div>
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-xxxxxxxx-x', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
